name: Jarvis Assistant

on:
  workflow_dispatch:
  repository_dispatch:
    types: [chatgpt_task]

jobs:
  execute-command:
    runs-on: ubuntu-latest
    steps:
      # –ö–ª–æ–Ω—É—î–º–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
      - name: Checkout repository
        uses: actions/checkout@v4

      # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ Git
      - name: Setup Git
        run: |
          git config --global user.name "Jarvis Assistant"
          git config --global user.email "bot@jarvis.ai"

      # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–æ–∫–µ–Ω –∑ —Å–µ–∫—Ä–µ—Ç—ñ–≤
      - name: Load Token
        env:
          GITHUB_TOKEN: ${{ secrets.GPT_TOKEN }}
        run: |
          echo "üîπ –¢–æ–∫–µ–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó —Ä–æ–±–æ—Ç–∏."

      # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∫–æ–º–∞–Ω–¥—É, —è–∫—É —è –¥–∞–º —á–µ—Ä–µ–∑ —á–∞—Ç
      - name: Save Command
        run: |
          echo "${{ github.event.client_payload.command }}" > command.txt
          echo "–ö–æ–º–∞–Ω–¥–∞ –≤—ñ–¥ –î–∂–∞—Ä–≤—ñ—Å–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞."

      # –í–∏–∫–æ–Ω—É—î–º–æ –∫–æ–º–∞–Ω–¥—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É –ø—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
      - name: Execute Command
        env:
          GITHUB_TOKEN: ${{ secrets.GPT_TOKEN }}
        run: |
          COMMAND=$(cat command.txt | cut -d' ' -f1)
          FILE=$(cat command.txt | cut -d' ' -f2)
          CONTENT=$(cat command.txt | cut -d' ' -f3-)
          
          if [ "$COMMAND" == "create_file" ]; then
            echo "$CONTENT" > "$FILE"
            echo "ü§ñ –§–∞–π–ª $FILE —Å—Ç–≤–æ—Ä–µ–Ω–æ. –ß–µ–∫–∞—î–º–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥–ª—è –ø—É—à—É."
            if [ "${{ github.event.client_payload.confirm }}" == "yes" ]; then
              git add "$FILE"
              git commit -m "ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è $FILE –≤—ñ–¥ Jarvis"
              git push origin main
              echo "‚úÖ –§–∞–π–ª $FILE —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π."
            fi
          fi
